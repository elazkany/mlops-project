schema: '2.0'
stages:
  check_for_new_data:
    cmd: python3 -m src.data.check_for_new_data
    deps:
    - path: params.yaml
      hash: md5
      md5: eb9229311e974e228c662b1b94d3af7b
      size: 903
    params:
      params.yaml:
        download.last_updated: data/last_updated.txt
        download.url: 
          https://www.kaggle.com/api/v1/datasets/download/mlg-ulb/creditcardfraud
    outs:
    - path: data/last_updated.txt
      hash: md5
      md5: d41d8cd98f00b204e9800998ecf8427e
      size: 0
  collect_data:
    cmd: python3 -m src.data.collect_and_extract 
      https://www.kaggle.com/api/v1/datasets/download/mlg-ulb/creditcardfraud 
      --out data/raw
    deps:
    - path: data/last_updated.txt
      hash: md5
      md5: d41d8cd98f00b204e9800998ecf8427e
      size: 0
    - path: params.yaml
      hash: md5
      md5: eb9229311e974e228c662b1b94d3af7b
      size: 903
    - path: src/data/collect_and_extract.py
      hash: md5
      md5: 78eb952afa4054c50b45e9c31bf30f40
      size: 2535
    params:
      params.yaml:
        download.out: data/raw
        download.url: 
          https://www.kaggle.com/api/v1/datasets/download/mlg-ulb/creditcardfraud
    outs:
    - path: data/raw/creditcard.csv
      hash: md5
      md5: e90efcb83d69faf99fcab8b0255024de
      size: 150828752
  preprocess:
    cmd: python3 -m src.data.preprocess
    deps:
    - path: data/raw/creditcard.csv
      hash: md5
      md5: e90efcb83d69faf99fcab8b0255024de
      size: 150828752
    - path: src/data/preprocess.py
      hash: md5
      md5: b615720bb36601572cfa818c81143a26
      size: 1036
    params:
      params.yaml:
        preprocess.processed_data_path: data/processed/processed_creditcard.csv
        preprocess.raw_data_path: data/raw/creditcard.csv
        preprocess.scale_columns:
        - Time
        - Amount
    outs:
    - path: data/processed/processed_creditcard.csv
      hash: md5
      md5: f4f163743df238c0e2dcd99bf42f82dd
      size: 158139932
  train:
    cmd: python3 src/train/train.py
    deps:
    - path: data/processed/processed_creditcard.csv
      hash: md5
      md5: f4f163743df238c0e2dcd99bf42f82dd
      size: 158139932
    - path: src/train/train.py
      hash: md5
      md5: dff1bfd903e8790148d4272e3a089221
      size: 2884
    params:
      params.yaml:
        train.processed_data_path: data/processed/processed_creditcard.csv
        train.random_state: 42
        train.target_column: Class
        train.test_size: 0.2
        train.train_data_path: data/split
    outs:
    - path: data/split/test.npz
      hash: md5
      md5: 07f55fe21a9a6b69a706cc130db3e69c
      size: 12855936
    - path: data/split/train_balanced.npz
      hash: md5
      md5: 2c5a253948ef9ac12b02bd2843f1ee6a
      size: 102934827
    - path: data/split/train_raw.npz
      hash: md5
      md5: c9280487bf347f977052099b0463e55c
      size: 51397361
  split:
    cmd: python3 -m src.train.split
    deps:
    - path: data/processed/processed_creditcard.csv
      hash: md5
      md5: f4f163743df238c0e2dcd99bf42f82dd
      size: 158139932
    - path: src/train/split.py
      hash: md5
      md5: 1985f5bf08db092b10003a42afc2832d
      size: 2575
    params:
      params.yaml:
        split.processed_data_path: data/processed/processed_creditcard.csv
        split.random_state: 42
        split.target_column: Class
        split.test_data_path: data/test
        split.test_size: 0.2
        split.train_data_path: data/train
        split.validation_data_path: data/validation
    outs:
    - path: data/test/X_test.json
      hash: md5
      md5: f7c20e9052b83913517eae974cbf1754
      size: 32967480
    - path: data/test/y_test.json
      hash: md5
      md5: 8f88110e7a885feecbc2c17cb49cbff6
      size: 683544
    - path: data/train/train_original.npz
      hash: md5
      md5: 6352a0d527195bc8034739cc69aca961
      size: 41121549
    - path: data/train/train_resampled.npz
      hash: md5
      md5: a5d3937bfd290e5f270891d7d0bdf3a4
      size: 82232742
    - path: data/validation/valid.npz
      hash: md5
      md5: 3104342580a8088e5b29285e19fbf0b2
      size: 10282416
  train_and_evaluate:
    cmd: python3 -m src.train.run_train
    deps:
    - path: data/train/train_original.npz
      hash: md5
      md5: 6352a0d527195bc8034739cc69aca961
      size: 41121549
    - path: data/train/train_resampled.npz
      hash: md5
      md5: a5d3937bfd290e5f270891d7d0bdf3a4
      size: 82232742
    - path: data/validation/valid.npz
      hash: md5
      md5: 3104342580a8088e5b29285e19fbf0b2
      size: 10282416
    - path: params.yaml
      hash: md5
      md5: eb9229311e974e228c662b1b94d3af7b
      size: 903
    - path: src/train/run_train.py
      hash: md5
      md5: b89b5c635b017647fe73b28b3075e633
      size: 1715
    - path: src/train/train_and_evaluate.py
      hash: md5
      md5: 0d1fc716d43db820964774908cc65bc1
      size: 2482
    outs:
    - path: mlruns
      hash: md5
      md5: dea64c4c4ccf832da2fa428975bb21bd.dir
      size: 15653654
      nfiles: 142
  find_best_model:
    cmd: python3 -m src.train.challenger_model
    deps:
    - path: mlruns
      hash: md5
      md5: 7f244870e496765134ede40d3c3675eb.dir
      size: 15654424
      nfiles: 146
    - path: params.yaml
      hash: md5
      md5: eb9229311e974e228c662b1b94d3af7b
      size: 903
    - path: src/train/challenger_model.py
      hash: md5
      md5: d202f862b581ad779cdce02891b20178
      size: 3470
    - path: src/train/run_train.py
      hash: md5
      md5: b89b5c635b017647fe73b28b3075e633
      size: 1715
    outs:
    - path: deployment/model_version.json
      hash: md5
      md5: d236cc646ac7628195edef4f467d9437
      size: 108
  report:
    cmd: python3 -m src.train.generate_cml_report
    deps:
    - path: mlruns
      hash: md5
      md5: 7f244870e496765134ede40d3c3675eb.dir
      size: 15654424
      nfiles: 146
    - path: params.yaml
      hash: md5
      md5: eb9229311e974e228c662b1b94d3af7b
      size: 903
    - path: src/train/challenger_model.py
      hash: md5
      md5: d202f862b581ad779cdce02891b20178
      size: 3470
    - path: src/train/generate_cml_report.py
      hash: md5
      md5: 86ae0324d6762b5f3d3ccdaa77dae590
      size: 2790
    - path: src/train/run_train.py
      hash: md5
      md5: b89b5c635b017647fe73b28b3075e633
      size: 1715
    outs:
    - path: reports/best_model_confusion_matrix.png
      hash: md5
      md5: a10c560c792bcfa8f75e53dfa31ee0e5
      size: 19955
    - path: reports/best_model_metrics.json
      hash: md5
      md5: 9c3e4fa82acf7f8d73f46374bb9acbd6
      size: 96
    - path: reports/compare_confusion_matrices.png
      hash: md5
      md5: eaca8278d20c6df1ac3a133f8d1584ea
      size: 85782
    - path: reports/compare_metrics.json
      hash: md5
      md5: ee1e7a0c6697c901686b164ae001a8da
      size: 565
