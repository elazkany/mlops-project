schema: '2.0'
stages:
  check_for_new_data:
    cmd: python3 src/data/check_for_new_data.py
    deps:
    - path: params.yaml
      hash: md5
      md5: fcae731f73ee7b048d251d9b22769d10
      size: 500
    params:
      params.yaml:
        download.last_updated: data/last_updated.txt
        download.url: 
          https://www.kaggle.com/api/v1/datasets/download/mlg-ulb/creditcardfraud
    outs:
    - path: data/last_updated.txt
      hash: md5
      md5: d41d8cd98f00b204e9800998ecf8427e
      size: 0
  collect_data:
    cmd: python3 src/data/collect_and_extract.py 
      https://www.kaggle.com/api/v1/datasets/download/mlg-ulb/creditcardfraud 
      --out data/raw
    deps:
    - path: data/last_updated.txt
      hash: md5
      md5: d41d8cd98f00b204e9800998ecf8427e
      size: 0
    - path: params.yaml
      hash: md5
      md5: fcae731f73ee7b048d251d9b22769d10
      size: 500
    - path: src/data/collect_and_extract.py
      hash: md5
      md5: 78eb952afa4054c50b45e9c31bf30f40
      size: 2535
    params:
      params.yaml:
        download.out: data/raw
        download.url: 
          https://www.kaggle.com/api/v1/datasets/download/mlg-ulb/creditcardfraud
    outs:
    - path: data/raw/creditcard.csv
      hash: md5
      md5: e90efcb83d69faf99fcab8b0255024de
      size: 150828752
  preprocess:
    cmd: python3 src/data/preprocess.py
    deps:
    - path: data/raw/creditcard.csv
      hash: md5
      md5: e90efcb83d69faf99fcab8b0255024de
      size: 150828752
    - path: src/data/preprocess.py
      hash: md5
      md5: ed4ae68183beba6f1731769972a32a04
      size: 2006
    params:
      params.yaml:
        preprocess.processed_data_path: data/processed/processed_creditcard.csv
        preprocess.raw_data_path: data/raw/creditcard.csv
        preprocess.scale_columns:
        - Time
        - Amount
    outs:
    - path: data/processed/processed_creditcard.csv
      hash: md5
      md5: f4f163743df238c0e2dcd99bf42f82dd
      size: 158139932
  train:
    cmd: python3 src/train/train.py
    deps:
    - path: data/processed/processed_creditcard.csv
      hash: md5
      md5: f4f163743df238c0e2dcd99bf42f82dd
      size: 158139932
    - path: src/train/train.py
      hash: md5
      md5: dff1bfd903e8790148d4272e3a089221
      size: 2884
    params:
      params.yaml:
        train.processed_data_path: data/processed/processed_creditcard.csv
        train.random_state: 42
        train.target_column: Class
        train.test_size: 0.2
        train.train_data_path: data/split
    outs:
    - path: data/split/test.npz
      hash: md5
      md5: 07f55fe21a9a6b69a706cc130db3e69c
      size: 12855936
    - path: data/split/train_balanced.npz
      hash: md5
      md5: 2c5a253948ef9ac12b02bd2843f1ee6a
      size: 102934827
    - path: data/split/train_raw.npz
      hash: md5
      md5: c9280487bf347f977052099b0463e55c
      size: 51397361
  split:
    cmd: python3 src/train/split.py
    deps:
    - path: data/processed/processed_creditcard.csv
      hash: md5
      md5: f4f163743df238c0e2dcd99bf42f82dd
      size: 158139932
    - path: src/train/split.py
      hash: md5
      md5: 4bd40768b51246e4b7c5260eb91a3695
      size: 2883
    params:
      params.yaml:
        split.processed_data_path: data/processed/processed_creditcard.csv
        split.random_state: 42
        split.split_data_path: data/split
        split.target_column: Class
        split.test_size: 0.2
    outs:
    - path: data/split/test.npz
      hash: md5
      md5: 07f55fe21a9a6b69a706cc130db3e69c
      size: 12855936
    - path: data/split/train_balanced.npz
      hash: md5
      md5: 2c5a253948ef9ac12b02bd2843f1ee6a
      size: 102934827
    - path: data/split/train_raw.npz
      hash: md5
      md5: c9280487bf347f977052099b0463e55c
      size: 51397361
